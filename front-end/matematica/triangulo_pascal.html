<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anima√ß√£o ‚Äî Tri√¢ngulo de Pascal</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --cell:#0b1723;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#07101a 0%,#071827 100%);color:#e6eef6}
    .app{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:16px}
    h1{font-size:1.25rem;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:rgba(255,255,255,0.03);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    label{font-size:0.85rem;color:var(--muted)}
    input[type=range]{width:170px}
    .btn{background:var(--accent);color:#012;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    #boardWrap{display:flex;justify-content:center;align-items:flex-start;margin-top:20px}
    #board{display:grid;gap:6px;align-items:center}
    .row{display:flex;justify-content:center;gap:6px}
    .cell{min-width:38px;min-height:38px;padding:6px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;font-weight:600;color:#cfeffc;box-shadow:inset 0 -6px 18px rgba(2,6,23,0.35);transition:transform .18s,background .18s}
    .cell.small{min-width:30px;min-height:30px;font-size:0.85rem}
    .cell.highlight{transform:translateY(-6px);background:linear-gradient(180deg,var(--accent),#33d6ea);color:#012}
    .cell.source{background:rgba(255,255,255,0.04);}
    .info{margin-top:10px;color:var(--muted);font-size:0.9rem}
    .footer{margin-top:18px;color:var(--muted);font-size:0.85rem}
    .grid-center{display:flex;justify-content:center}
    .row-index{font-size:0.8rem;color:var(--muted);margin-right:8px;align-self:center}
    .controls .group{display:flex;flex-direction:column}
    .controls .hgroup{display:flex;gap:8px;align-items:center}
    .controls input[type=number]{width:76px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .legend{display:flex;gap:8px;align-items:center;margin-left:12px}
    .legend .dot{width:12px;height:12px;border-radius:4px}
    .legend .dot.a{background:var(--accent)}
    .legend .dot.b{background:rgba(255,255,255,0.06)}
    @media (max-width:600px){.cell{min-width:28px;min-height:28px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Tri√¢ngulo de Pascal ‚Äî Anima√ß√£o Interativa</h1>
        <div style="color:var(--muted);font-size:0.9rem">Veja as linhas sendo constru√≠das passo a passo ‚Äî passe o mouse sobre c√©lulas para ver a f√≥rmula.</div>
      </div>
    </header>

    <div class="controls card">
      <div style="display:flex;gap:18px;align-items:center;flex-wrap:wrap">
        <div class="hgroup">
          <label for="rows">Linhas</label>
          <input id="rows" type="number" min="1" max="20" value="10">
        </div>

        <div class="hgroup">
          <label for="speed">Velocidade</label>
          <input id="speed" type="range" min="100" max="1500" step="50" value="400">
        </div>

        <div class="hgroup">
          <button id="play" class="btn">‚ñ∂Ô∏è Iniciar</button>
          <button id="pause" class="btn secondary">‚è∏Ô∏è Pausar</button>
          <button id="reset" class="btn secondary">üîÅ Reiniciar</button>
        </div>

        <div class="legend">
          <div style="font-size:0.85rem;color:var(--muted)">Legenda:</div>
          <div class="dot a"></div><div style="color:var(--muted)"> c√©lula atual</div>
          <div class="dot b" style="margin-left:8px"></div><div style="color:var(--muted)"> fonte (1)</div>
        </div>
      </div>

      <div class="info">Dica: Ao passar o mouse sobre uma c√©lula ver√° a express√£o <code>nCk</code> e os pais que geraram o valor.</div>
    </div>

    <div id="boardWrap">
      <div id="board" aria-live="polite"></div>
    </div>

    <div class="footer">Professor George ‚Äî anima√ß√£o em JavaScript (arquivo √∫nico). Use os controles acima para experimentar.</div>
  </div>

  <script>
    // --- estado & util ---
    const board = document.getElementById('board');
    const rowsInput = document.getElementById('rows');
    const speedInput = document.getElementById('speed');
    const playBtn = document.getElementById('play');
    const pauseBtn = document.getElementById('pause');
    const resetBtn = document.getElementById('reset');

    let nRows = parseInt(rowsInput.value,10);
    let speed = parseInt(speedInput.value,10);
    let timer = null;
    let currentRow = 0;
    let triangle = [];

    function clearBoard(){ board.innerHTML = ''; }

    function buildEmptyBoard(n){
      clearBoard();
      board.style.gridTemplateColumns = `1fr`;
      triangle = [];
      for(let i=0;i<n;i++){
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        rowEl.dataset.row = i;
        board.appendChild(rowEl);
        triangle.push([]);
      }
    }

    function createCell(value, row, col){
      const el = document.createElement('div');
      el.className = 'cell';
      el.textContent = (value === 0 ? '' : value);
      el.dataset.row = row; el.dataset.col = col;
      el.title = `(${row}, ${col})`;
      el.addEventListener('mouseenter', () => showFormula(el));
      el.addEventListener('mouseleave', () => hideFormula(el));
      return el;
    }

    function showFormula(el){
      const r = Number(el.dataset.row), c = Number(el.dataset.col);
      if(r === 0){ el.title = `Linha ${r} ‚Äî nCk = 1`; return; }
      const left = getValue(r-1, c-1); const right = getValue(r-1,c);
      el.title = `nCk ((${r})C${c}) = ${left} + ${right} = ${getValue(r,c)}`;
    }
    function hideFormula(el){ /* no-op */ }

    function getValue(r,c){
      if(r<0 || c<0 || c>r) return 0;
      return triangle[r][c] ?? 0;
    }

    function renderRowSkeleton(rowIndex){
      const rowEl = board.children[rowIndex];
      rowEl.innerHTML = '';
      const pad = ' '.repeat(0);
      for(let j=0;j<=rowIndex;j++){
        const cell = createCell('', rowIndex, j);
        if(j===0||j===rowIndex) cell.classList.add('source');
        rowEl.appendChild(cell);
      }
    }

    function computeNextCell(row, col){
      // borda = 1
      if(col===0 || col===row) return 1;
      return getValue(row-1,col-1) + getValue(row-1,col);
    }

    function animateBuild(){
      if(currentRow >= nRows){ stopTimer(); return; }
      renderRowSkeleton(currentRow);
      let col = 0;

      function step(){
        const rowEl = board.children[currentRow];
        const cellEl = rowEl.children[col];
        // highlight parents
        if(col>0 && col<currentRow){
          const leftEl = board.children[currentRow-1].children[col-1];
          const rightEl = board.children[currentRow-1].children[col] || null;
          if(leftEl) leftEl.classList.add('highlight');
          if(rightEl) rightEl.classList.add('highlight');
        }

        cellEl.classList.add('highlight');
        const value = computeNextCell(currentRow,col);

        setTimeout(()=>{
          // write value
          cellEl.textContent = value;
          triangle[currentRow][col] = value;

          // remove highlights
          Array.from(board.querySelectorAll('.highlight')).forEach(x=>x.classList.remove('highlight'));

          col++;
          if(col <= currentRow){
            timer = setTimeout(step, speed);
          } else {
            // linha completa
            currentRow++;
            timer = setTimeout(animateBuild, speed);
          }
        }, speed/2);
      }

      step();
    }

    function startTimer(){ if(timer) return; animateBuild(); }
    function stopTimer(){ if(timer){ clearTimeout(timer); timer = null; }}
    function reset(){ stopTimer(); nRows = parseInt(rowsInput.value,10); currentRow = 0; buildEmptyBoard(nRows); }

    // --- eventos ---
    rowsInput.addEventListener('change', ()=>{
      const v = parseInt(rowsInput.value,10);
      if(Number.isNaN(v) || v < 1) rowsInput.value = 1;
      if(v>20) rowsInput.value = 20;
      nRows = parseInt(rowsInput.value,10);
      reset();
    });

    speedInput.addEventListener('input', ()=>{ speed = parseInt(speedInput.value,10); });
    playBtn.addEventListener('click', ()=>{ startTimer(); });
    pauseBtn.addEventListener('click', ()=>{ stopTimer(); });
    resetBtn.addEventListener('click', ()=>{ reset(); });

    // inicializar
    (function init(){
      buildEmptyBoard(nRows);
      // pre-popula a primeira linha
      triangle[0] = [1];
      const firstRow = board.children[0];
      firstRow.innerHTML = '';
      firstRow.appendChild(createCell(1,0,0));
    })();

    // acessibilidade: teclas
    document.addEventListener('keydown', (e)=>{
      if(e.key === ' ') { e.preventDefault(); if(timer) stopTimer(); else startTimer(); }
    });
  </script>
</body>
</html>
